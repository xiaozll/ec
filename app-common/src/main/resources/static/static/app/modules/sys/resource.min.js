var hasPermissionResourceEdit=hasPermissionResourceEdit;var hasPermissionResourceRoleEdit=hasPermissionResourceRoleEdit;var hasPermissionResourceUserEdit=hasPermissionResourceUserEdit;var $resource_treegrid;var $resource_form;var $resource_dialog;var $resource_role_dialog;var $resource_user_dialog;$(function(){var a=[];if(hasPermissionResourceEdit){a=a.concat([{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},"-",{text:"编辑",iconCls:"easyui-icon-edit",handler:function(){edit()}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}},"-"])}if(hasPermissionResourceRoleEdit){a=a.concat([{text:"角色",iconCls:"eu-icon-lock",handler:function(){resourceRole()}},"-"])}if(hasPermissionResourceUserEdit){a=a.concat([{text:"用户",iconCls:"eu-icon-user",handler:function(){resourceUser()}},"-"])}$resource_treegrid=$("#resource_treegrid").treegrid({url:ctxAdmin+"/sys/resource/treegrid",fit:true,fitColumns:false,striped:true,rownumbers:true,nowrap:false,border:false,singleSelect:true,remoteSort:false,sortName:"sort",sortOrder:"asc",idField:"id",treeField:"name",frozenColumns:[[{field:"name",title:"资源名称",width:300},{field:"code",title:"资源编码",width:260}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,width:80},{field:"url",title:"链接地址",width:260},{field:"markUrl",title:"标识地址",width:260,hidden:true},{field:"sort",title:"排序",align:"right",width:60,sortable:true},{field:"typeView",title:"资源类型",align:"center",width:100},{field:"statusView",title:"状态",align:"center",width:60},{field:"remark",title:"备注",width:260},{field:"updateTime",title:"更新时间",width:146}]],toolbar:a,onContextMenu:function(b,c){b.preventDefault();$(this).treegrid("select",c.id);$("#resource_menu").menu("show",{left:b.pageX,top:b.pageY})},onDblClickRow:function(b){if(hasPermissionResourceEdit){edit(b)}}}).datagrid("showTooltip")});function formInit(){$resource_form=$("#resource_form").form({url:ctxAdmin+"/sys/resource/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code===1){$resource_dialog.dialog("destroy");$resource_treegrid.treegrid("reload");eu.showMsg(a.msg)}else{if(a.code===2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#resource_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}},onLoadSuccess:function(a){if(a!==undefined&&a._parentId!==undefined){$("#_parentId").combotree("setValue",a._parentId)}}})}function showDialog(c){var b=ctxAdmin+"/sys/resource/input";if(c!==undefined&&c.id){b=b+"?id="+c.id}else{var a=$resource_treegrid.treegrid("getSelected");if(a&&a.type!==undefined){b+="?parentId="+a.id}}$resource_dialog=$("<div/>").dialog({title:"资源详细信息",top:20,width:500,height:360,modal:true,maximizable:true,resizable:true,href:b,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$resource_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$resource_dialog.dialog("destroy")}}],onClose:function(){$resource_dialog.dialog("destroy")},onLoad:function(){formInit()}})}function edit(a){if(a===undefined){a=$resource_treegrid.treegrid("getSelected")}if(a!==undefined){showDialog(a)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function del(b){var a;if(b===undefined){a=$resource_treegrid.treegrid("getSelected")}if(a!==undefined){$.messager.confirm("确认提示！","您确定要删除(如果存在子节点，子节点也一起会被删除)？",function(c){if(c){$.post(ctxAdmin+"/sys/resource/delete/"+a.id,{},function(d){if(d.code===1){$resource_treegrid.treegrid("unselectAll");$resource_treegrid.treegrid("load");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}},"json")}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function resourceRole(b){if(b===undefined){b=$resource_treegrid.treegrid("getSelected")}if(b===undefined){eu.showMsg("您未选择任何操作对象，请选择一行数据！");return}var a=ctxAdmin+"/sys/resource/role/"+b.id;$resource_role_dialog=$("<div/>").dialog({title:"授权角色详细信息",top:20,width:500,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$resource_role_dialog.dialog("destroy")}}],onClose:function(){$resource_role_dialog.dialog("destroy")}})}function resourceUser(b){if(b===undefined){b=$resource_treegrid.treegrid("getSelected")}if(b===undefined){eu.showMsg("您未选择任何操作对象，请选择一行数据！");return}var a=ctxAdmin+"/sys/resource/user/"+b.id;$resource_user_dialog=$("<div/>").dialog({title:"授权用户（非角色传递）详细信息",top:20,width:500,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$resource_user_dialog.dialog("destroy")}}],onClose:function(){$resource_user_dialog.dialog("destroy")}})};