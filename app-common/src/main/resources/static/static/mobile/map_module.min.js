var M=$.extend({},M);M.defaultPoint=function(){return{longitude:115.890076,latitude:28.658231}};M.getDistance=function(d,i,c,g){var f=d*Math.PI/180;var e=c*Math.PI/180;var j=f-e;var h=i*Math.PI/180-g*Math.PI/180;var k=2*Math.asin(Math.sqrt(Math.pow(Math.sin(j/2),2)+Math.cos(f)*Math.cos(e)*Math.pow(Math.sin(h/2),2)));k=k*6378137/1000;k=Math.round(k*10000)/10000;return k.toFixed(2)};M.bdConverToGPS=function(a,e){var h=3.141592653589793*3000/180;var g=a-0.0065;var f=e-0.006;var d=Math.sqrt(g*g+f*f)-0.00002*Math.sin(f*h);var b=Math.atan2(f,g)-0.000003*Math.cos(g*h);var i=d*Math.cos(b);var c=d*Math.sin(b);return{lng:i,lat:c}};M.toNavigation=function(c){var b=M.defaultPoint();b=$.extend(b,c);var d=window.navigator.userAgent.toLowerCase();if(d.match(/MicroMessenger/i)=="micromessenger"){var a=M.bdConverToGPS(b.longitude,b.latitude);$.getJSON(appURL+"/m/qyweixin/jssdk?callback=?&url="+location.href,function(e){wx.config({beta:true,debug:false,appId:e.obj.appid,timestamp:e.obj.timestamp,nonceStr:e.obj.nonceStr,signature:e.obj.signature,jsApiList:["openLocation"]});wx.openLocation({latitude:a.lat,longitude:a.lng,name:b.name,address:b.name,scale:25,infoUrl:""})})}else{try{if(b.mapExtend){location.href="baidumap://map/marker?location="+b.latitude+","+b.longitude+"&title="+b.name+"&name="+b.name+"&content="+b.name+"&output=html&src=MP_BROWSER"}else{location.href="http://api.map.baidu.com/marker?location="+b.latitude+","+b.longitude+"&title="+b.name+"&name="+b.name+"&content="+b.name+"&output=html&src=MP_BROWSER"}}catch(f){}}};M.getCurrentPosition=function(c,f,b,d){var a={enableHighAccuracy:true,maximumAge:60000,timeout:20000};a=$.extend(a,c);function e(h){var g="";switch(h.code){case 1:g="位置服务被拒绝";break;case 2:g="暂时获取不到位置信息";break;case 3:g="获取信息超时";break;case 4:g="未知错误";break}var i=g+"，"+h.message;console.error(i);if(!d){toastr.error(g)}}e=b?b:e;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(f,e,a)}else{if(!d){toastr.error("未开启或不支持GPS地理位置服务")}}};