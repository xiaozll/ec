var $organ_treegrid;var $organ_form;var $organ_user_form;var $organ_dialog;var $organ_user_dialog;$(function(){$organ_treegrid=$("#organ_treegrid").treegrid({url:ctxAdmin+"/sys/organ/treegrid",fit:true,fitColumns:false,striped:true,rownumbers:true,nowrap:false,border:false,singleSelect:true,remoteSort:false,sortName:"sort",sortOrder:"asc",idField:"id",treeField:"name",frozenColumns:[[{field:"name",title:"机构名称",width:200},{field:"sysCode",title:"机构系统编码",width:120,hidden:true}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,align:"right",width:80},{field:"managerUserName",title:"主管",width:120},{field:"superManagerUserName",title:"分管领导",width:120},{field:"code",title:"机构编码",width:120},{field:"address",title:"地址",width:120},{field:"mobile",title:"手机号",width:120,sortable:true},{field:"phone",title:"电话号码",width:120,sortable:true},{field:"fax",title:"传真",width:120,sortable:true},{field:"typeView",title:"机构类型",width:100},{field:"sort",title:"排序",align:"right",width:60,sortable:true},{field:"statusView",title:"状态",align:"center",width:60}]],toolbar:[{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},"-",{text:"编辑",iconCls:"easyui-icon-edit",handler:function(){edit()}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}},"-",{text:"设置用户",iconCls:"eu-icon-user",handler:function(){editOrganUser()}}],onBeforeLoad:function(b,a){if(b){a.parentId=b.id}},onContextMenu:function(a,b){a.preventDefault();$(this).treegrid("select",b.id);$("#organ_menu").menu("show",{left:a.pageX,top:a.pageY})},onDblClickRow:function(a){edit(a)},onLoadSuccess:function(b){var a=$(this).treegrid("getRoot");if(a){$(this).treegrid("expand",a.id)}}}).datagrid("showTooltip")});function formInit(){$organ_form=$("#organ_form").form({url:ctxAdmin+"/sys/organ/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){$organ_dialog.dialog("destroy");$organ_treegrid.treegrid("reload");eu.showMsg(a.msg)}else{if(a.code==2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#organ_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}}})}function showDialog(c){var b=ctxAdmin+"/sys/organ/input";if(c!=undefined&&c.id){b=b+"?id="+c.id}else{var a=$organ_treegrid.treegrid("getSelected");if(a!=undefined&&a.id!=undefined){b+="?parentId="+a.id}}$organ_dialog=$("<div/>").dialog({title:"机构详细信息",top:20,width:500,height:360,modal:true,maximizable:true,href:b,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$organ_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$organ_dialog.dialog("destroy")}}],onClose:function(){$organ_dialog.dialog("destroy")},onLoad:function(){formInit()}})}function edit(a){if(a==undefined){a=$organ_treegrid.treegrid("getSelected")}if(a!=undefined){showDialog(a)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function initOrganUserForm(){$organ_user_form=$("#organ_user_form").form({url:ctxAdmin+"/sys/organ/updateOrganUser",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){$organ_user_dialog.dialog("destroy");$organ_treegrid.treegrid("reload");eu.showMsg(a.msg)}else{eu.showAlertMsg(a.msg,"error")}}})}function editOrganUser(){var b=$organ_treegrid.treegrid("getSelected");if(b){var a=ctxAdmin+"/sys/organ/user";if(b!=undefined&&b.id){a=a+"?id="+b.id}$organ_user_dialog=$("<div/>").dialog({title:"机构用户信息",top:20,height:200,width:600,modal:true,maximizable:true,href:a,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$organ_user_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$organ_user_dialog.dialog("destroy")}}],onClose:function(){$organ_user_dialog.dialog("destroy")},onLoad:function(){initOrganUserForm()}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function del(b){var a;if(b==undefined){a=$organ_treegrid.treegrid("getSelected")}if(a!=undefined){$.messager.confirm("确认提示！","您确定要删除(如果存在子节点，子节点也一起会被删除)？",function(c){if(c){$.post(ctxAdmin+"/sys/organ/delete/"+a.id,{},function(d){if(d.code==1){$organ_treegrid.treegrid("unselectAll");$organ_treegrid.treegrid("load");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}},"json")}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}};