var $contactGroup_tree;var $contactGroup_user_tree;var $contactGroup_mail_tree;var $contactGroup_form;var $contactGroup_dialog;var $contactGroup_search_form;var $contactGroup_datagrid;var $contactGroup_user_datagrid;var $contactGroup_mail_datagrid;var $contactGroupMail_form;var $contactGroupMail_dialog;var isUser=1;$(function(){$contactGroup_search_form=$("#contactGroup_search_form").form();$("#groupTree-tabs").tabs({onSelect:function(b,a){initData(true)}});treeUser();treeMail()});function treeUser(){var a=false;$contactGroup_user_tree=$("#contactGroup_user_tree").tree({url:ctxAdmin+"/notice/contactGroup/groupTree?contactGroupType=0",formatter:function(b){return b.text},onClick:function(b){},onSelect:function(b){listUser(b.id);initData()},onContextMenu:function(c,b){c.preventDefault();if(b.id!=undefined&&b.id!=""){$("#treeMenu").menu({onClick:function(d){if(d.name=="edit"){showDialog(b.id,0)}else{if(d.name=="delete"){del(b.id,b.text)}}}}).menu("show",{left:c.pageX,top:c.pageY})}},onLoadSuccess:function(b,c){$(this).tree("expandAll")}})}function treeMail(){var a=false;$contactGroup_mail_tree=$("#contactGroup_mail_tree").tree({url:ctxAdmin+"/notice/contactGroup/groupTree?contactGroupType=1",formatter:function(b){return b.text},onClick:function(b){},onSelect:function(b){listMail(b.id);initData()},onContextMenu:function(c,b){c.preventDefault();if(b.id!=undefined&&b.id!=""){$("#treeMenu").menu({onClick:function(d){if(d.name=="edit"){showDialog(b.id,1)}else{if(d.name=="delete"){del(b.id,b.text)}}}}).menu("show",{left:c.pageX,top:c.pageY})}},onLoadSuccess:function(b,c){$(this).tree("expandAll")}})}function listUser(a){var b=null;if(a){b=[{text:"添加",iconCls:"easyui-icon-add",handler:function(){addContactGroupUserDialog(a)}},"-",{text:"移除",iconCls:"easyui-icon-remove",handler:function(){removeContactGroupObject("",a)}}]}$contactGroup_user_datagrid=$("#contactGroup_datagrid").datagrid({url:ctxAdmin+"/notice/contactGroup/contactGroupUserDatagrid",fit:true,rownumbers:true,fitColumns:false,striped:true,remoteSort:false,idField:"id",frozen:true,collapsible:true,toolbar:b,queryParams:{id:a},frozenColumns:[[{field:"ck",checkbox:true},{field:"name",title:"姓名",width:120},{field:"loginName",title:"登录名",width:120,hidden:true},{field:"sexView",title:"性别",width:60}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,align:"right",width:80},{field:"organNames",title:"部门",width:200},{field:"mobilephone",title:"手机号",width:120},{field:"tel",title:"电话",width:120},{field:"email",title:"邮箱",width:120},{field:"operate",title:"操作",hidden:true,formatter:function(d,c,e){return"&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-remove\"' onclick='removeContactGroupObject(\""+c.id+'","'+a+"\")'>移除</a>&nbsp;"}}]]}).datagrid("showColumn","operate")}function listMail(a){var b=null;if(a){b=[{text:"新增",iconCls:"easyui-icon-add",handler:function(){editMail(undefined,a)}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){removeContactGroupObject("",a)}}]}$contactGroup_mail_datagrid=$("#contactGroup_datagrid").datagrid({url:ctxAdmin+"/notice/mailContact/contactGroupMailDatagrid",fit:true,rownumbers:true,fitColumns:false,striped:true,remoteSort:false,pagination:true,pagePosition:"bottom",pageSize:20,pageList:[10,20,50,100,1000,99999],idField:"id",toolbar:b,queryParams:{id:a},frozen:true,collapsible:true,frozenColumns:[[{field:"ck",checkbox:true},{field:"name",title:"名称",width:120},{field:"email",title:"邮箱",width:200}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,align:"right",width:80},{field:"remark",title:"备注",width:350},{field:"operate",title:"操作",hidden:true,formatter:function(d,c,e){return"&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-edit\"' onclick='editMail(\""+c.id+'","'+a+"\")'>编辑</a>&nbsp;<a class='easyui-linkbutton' data-options='iconCls:\"easyui-icon-remove\"' onclick='removeContactGroupObject(\""+c.id+'","'+a+"\")'>删除</a>&nbsp;"}}]],onRowContextMenu:function(d,f,c){d.preventDefault();$(this).datagrid("unselectAll");$(this).datagrid("selectRow",f);$("#role_datagrid_menu").menu("show",{left:d.pageX,top:d.pageY})}}).datagrid("showColumn","operate")}function editMailContact(a){var b=$contactGroup_user_datagrid.datagrid("getSelections");var c=$contactGroup_user_datagrid.datagrid("getSelected");if(c){if(b.length>1){c=b[b.length-1];eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！");$contactGroup_mail_datagrid.datagrid("clearSelections");var d=$contactGroup_mail_datagrid.datagrid("getRowIndex",c);$contactGroup_mail_datagrid.datagrid("selectRow",d)}editMail(c.id,a)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function formInit(){$contactGroup_form=$("#contactGroup_form").form({url:ctxAdmin+"/notice/contactGroup/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){$contactGroup_dialog.dialog("destroy");initData();$contactGroup_tree.tree("reload");eu.showMsg(a.msg)}else{if(a.code==2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#$contactGroup_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}}})}function showDialog(a,b){var c=ctxAdmin+"/notice/contactGroup/input?contactGroupType="+b;if(a){c=c+"&id="+a}$contactGroup_dialog=$("<div/>").dialog({title:"联系人组信息",top:20,height:360,width:500,modal:true,maximizable:true,href:c,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$contactGroup_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$contactGroup_dialog.dialog("destroy")}}],onClose:function(){$(this).dialog("destroy")},onLoad:function(){formInit()}})}function del(a,b){$.messager.confirm("确认提示！","您确定要删除["+b+"]？",function(d){if(d){var c=[];c.push(a);$.ajax({url:ctxAdmin+"/notice/contactGroup/remove",type:"post",data:{ids:c},dataType:"json",traditional:true,success:function(e){if(e.code==1){$contactGroup_user_datagrid.datagrid("reload");refreshDatagrid=true;initData();$contactGroup_tree.tree("reload");eu.showMsg(e.msg)}else{eu.showAlertMsg(e.msg,"error")}}})}})}function addContactGroupUserDialog(a){_dialog=$("<div/>").dialog({title:"选择用户",top:10,href:ctxAdmin+"/notice/contactGroup/select?contactGroupId="+a,width:"700",height:"450",maximizable:true,iconCls:"eu-icon-user",modal:true,buttons:[{text:"确定",iconCls:"easyui-icon-save",handler:function(){addContactGroupUser(a)}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){_dialog.dialog("destroy")}}],onClose:function(){_dialog.dialog("destroy")}})}function addContactGroupUser(b){var a=[];$("#selectUser option").each(function(){var c=$(this).val();a.push($.trim(c))});$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});$.ajax({url:ctxAdmin+"/notice/contactGroup/addContactGroupUser?id="+b,type:"post",data:{addObjectIds:a},dataType:"json",traditional:true,success:function(c){$.messager.progress("close");if(c.code==1){initData();$contactGroup_tree.tree("reload");_dialog.dialog("destroy");eu.showMsg(c.msg)}else{eu.showAlertMsg(c.msg,"error")}}})}function mailformInit(){$contactGroupMail_form=$("#contactGroupMail_form").form({url:ctxAdmin+"/notice/mailContact/_save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){$contactGroupMail_dialog.dialog("destroy");initData();$contactGroup_datagrid.datagrid("reload");eu.showMsg(a.msg)}else{eu.showAlertMsg(a.msg,"error")}}})}function editMail(b,a){var c=$contactGroup_tree.tree("getSelected");var d=ctxAdmin+"/notice/mailContact/input";if(b!=undefined){d+="?id="+b;if(a){d+="&contactGroupId="+a}}else{if(a){d+="?contactGroupId="+a}}if(c!=undefined&&c.id!=undefined){$contactGroupMail_dialog=$("<div/>").dialog({title:"邮件联系人",top:20,height:360,width:500,modal:true,maximizable:true,href:d,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$contactGroupMail_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$contactGroupMail_dialog.dialog("destroy")}}],onClose:function(){$(this).dialog("destroy")},onLoad:function(){mailformInit()}})}}function removeContactGroupObject(b,a){var e=[];$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});if(b!=undefined&&b!=""){e.push(b)}else{var d=$contactGroup_datagrid.datagrid("getSelections");var f=$contactGroup_datagrid.datagrid("getSelected");$.each(d,function(g,h){e.push(h.id)})}if(e.length<1){$.messager.progress("close");eu.showAlertMsg("无法执行该操作.");return}var c=ctxAdmin+"/notice/contactGroup/removeContactGroupUser?id="+a;$.ajax({url:c,type:"post",data:{removeObjectIds:e},dataType:"json",traditional:true,success:function(g){$.messager.progress("close");if(g.code==1){initData();$contactGroup_datagrid.datagrid("reload");eu.showMsg(g.msg)}else{eu.showAlertMsg(g.msg,"error")}}})}function initData(a){var c=$("#groupTree-tabs").tabs("getSelected");var b=$("#groupTree-tabs").tabs("getTabIndex",c);if(b==0){$contactGroup_datagrid=$contactGroup_user_datagrid;$contactGroup_tree=$contactGroup_user_tree;if(a){listUser()}}else{if(b==1){$contactGroup_datagrid=$contactGroup_mail_datagrid;$contactGroup_tree=$contactGroup_mail_tree;if(a){listMail()}}}}function search(){var a="";if($contactGroup_tree){var b=$contactGroup_tree.tree("getSelected");if(b){a=b.id}}if($contactGroup_datagrid!=undefined){$contactGroup_datagrid.datagrid({queryParams:{id:a,query:$("#query").val()}})}};