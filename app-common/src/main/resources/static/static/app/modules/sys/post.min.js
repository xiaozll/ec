var sessionInfoUserId=sessionInfoUserId;var hasPermissionPostEdit=hasPermissionPostEdit;var hasPermissionPostUserEdit=hasPermissionPostUserEdit;var $organ_tree;var $post_datagrid;var $post_form;var $post_search_form;var $post_dialog;var $post_user_dialog;$(function(){$post_search_form=$("#post_search_form").form();var b=null;$organ_tree=$("#organ_tree").tree({url:ctxAdmin+"/sys/organ/tree?dataScope=4&cascade=true",onClick:function(c){search()},onBeforeSelect:function(d){var c=$(this).tree("getSelected");if(c){if(c.id===d.id){$(".tree-node-selected",$(this).tree()).removeClass("tree-node-selected");b=null;return false}}b=d;return true},onLoadSuccess:function(d,e){if(b!=null){b=$(this).tree("find",b.id);if(b!=null){$(this).tree("select",b.target)}}var c=$(this).tree("getRoot");if(c){$(this).tree("expand",c.target)}}});var a=[];if(hasPermissionPostEdit){a=a.concat([{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},"-",{text:"编辑",iconCls:"easyui-icon-edit",handler:function(){edit()}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}},"-"])}if(hasPermissionPostUserEdit){a=a.concat([{text:"设置用户",iconCls:"eu-icon-user",handler:function(){editPostUser()}},"-",])}$post_datagrid=$("#post_datagrid").datagrid({url:ctxAdmin+"/sys/post/datagrid",fit:true,pagination:true,rownumbers:true,fitColumns:false,striped:true,pageSize:20,remoteSort:false,idField:"id",frozen:true,collapsible:true,frozenColumns:[[{field:"ck",checkbox:true},{field:"name",title:"岗位名称",width:200,sortable:true}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,width:80},{field:"organName",title:"所属机构",width:200,hidden:false},{field:"code",title:"岗位编码",width:200,sortable:true},{field:"sort",title:"排序号",align:"right",width:100,sortable:true},{field:"remark",title:"备注",width:260},{field:"updateTime",title:"更新时间",width:146}]],toolbar:a,onLoadSuccess:function(){$(this).datagrid("clearSelections");$(this).datagrid("unselectAll")},onRowContextMenu:function(d,f,c){d.preventDefault();$(this).datagrid("unselectAll");$(this).datagrid("selectRow",f);$("#post_datagrid_menu").menu("show",{left:d.pageX,top:d.pageY})},onDblClickRow:function(d,c){if(hasPermissionPostEdit){edit(d,c)}}}).datagrid("showTooltip")});function formInit(){$post_form=$("#post_form").form({url:ctxAdmin+"/sys/post/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code===1){$post_dialog.dialog("destroy");$post_datagrid.datagrid("reload");$organ_tree.tree("reload");eu.showMsg(a.msg)}else{if(a.code===2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#post_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}}})}function showDialog(c){var b=ctxAdmin+"/sys/post/input";if(c!==undefined&&c.id){b+="?id="+c.id}else{var a=$organ_tree.tree("getSelected");if(a!=null){b+="?organId="+a.id}}$post_dialog=$("<div/>").dialog({title:"岗位详细信息",top:20,width:500,height:360,modal:true,maximizable:true,href:b,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$post_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$post_dialog.dialog("destroy")}}],onClose:function(){$post_dialog.dialog("destroy")},onLoad:function(){formInit()}})}function edit(d,b){if(d!==undefined){showDialog(b);return}var a=$post_datagrid.datagrid("getSelections");var c=$post_datagrid.datagrid("getSelected");if(c){if(a.length>1){c=a[a.length-1];eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！")}showDialog(c)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function editPostUser(){var b=$post_datagrid.datagrid("getSelections");var c=$post_datagrid.datagrid("getSelected");if(c){if(b.length>1){eu.showMsg("您选择了多个操作对象，默认操作第一次被选中的记录！")}var a=ctxAdmin+"/sys/post/user?id="+c.id;$post_user_dialog=$("<div/>").dialog({title:"岗位用户信息-"+c.id,top:20,width:600,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$post_user_dialog.dialog("destroy")}}],onClose:function(){$post_user_dialog.dialog("destroy")},onLoad:function(){}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function del(){var a=$post_datagrid.datagrid("getSelections");if(a.length>0){$.messager.confirm("确认提示！","您确定要删除选中的所有行?",function(c){if(c){var b=[];$.each(a,function(d,e){b[d]=e.id});$.ajax({url:ctxAdmin+"/sys/post/remove",type:"post",data:{ids:b},dataType:"json",traditional:true,success:function(d){if(d.code===1){$post_datagrid.datagrid("load");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}}})}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function search(){var d=$organ_tree.tree("getSelected");var b="";if(d!=null){b=d.id}var a={};var c={organId:b};var e=$.serializeObject($post_search_form);a=$.extend(a,c,e);$post_datagrid.datagrid("load",a)};