var role_datagrid;var role_form;var role_search_form;var role_resource_form;var role_user_form;var role_dialog;var role_resource_dialog;var role_user_dialog;$(function(){role_form=$("#role_form").form();role_search_form=$("#role_search_form").form();role_datagrid=$("#role_datagrid").datagrid({url:ctxAdmin+"/sys/role/datagrid",fit:true,pagination:true,rownumbers:true,fitColumns:false,striped:true,pageSize:20,idField:"id",frozenColumns:[[{field:"ck",checkbox:true},{field:"name",title:"角色名称",width:200},{field:"code",title:"角色编码",width:120}]],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,align:"right",width:80},{field:"isSystemView",title:"系统角色",width:60},{field:"organName",title:"所属机构",width:200},{field:"dataScopeView",title:"数据范围",width:200},{field:"remark",title:"备注",width:200}]],toolbar:[{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},"-",{text:"编辑",iconCls:"easyui-icon-edit",handler:function(){edit()}},"-",{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}},"-",{text:"设置资源",iconCls:"easyui-icon-edit",handler:function(){editRoleResource()}},"-",{text:"设置用户",iconCls:"easyui-icon-edit",handler:function(){editRoleUser()}}],onLoadSuccess:function(){$(this).datagrid("clearSelections");$(this).datagrid("unselectAll")},onRowContextMenu:function(b,c,a){b.preventDefault();$(this).datagrid("unselectAll");$(this).datagrid("selectRow",c);$("#role_datagrid_menu").menu("show",{left:b.pageX,top:b.pageY})},onDblClickRow:function(b,a){edit(b,a)}}).datagrid("showTooltip")});function formInit(){role_form=$("#role_form").form({url:ctxAdmin+"/sys/role/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){role_dialog.dialog("destroy");role_datagrid.datagrid("reload");eu.showMsg(a.msg)}else{if(a.code==2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#role_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}}})}function showDialog(b){var a=ctxAdmin+"/sys/role/input";if(b!=undefined&&b.id){a=a+"?id="+b.id}role_dialog=$("<div/>").dialog({title:"角色详细信息",top:20,width:500,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){role_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){role_dialog.dialog("destroy")}}],onClose:function(){role_dialog.dialog("destroy")},onLoad:function(){formInit()}})}function edit(d,b){if(d!=undefined){showDialog(b);return}var a=role_datagrid.datagrid("getSelections");var c=role_datagrid.datagrid("getSelected");if(c){if(a.length>1){c=a[a.length-1];eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！")}showDialog(c)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function initRoleResourceForm(){role_resource_form=$("#role_resource_form").form({url:ctxAdmin+"/sys/role/updateRoleResource",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code==1){role_resource_dialog.dialog("destroy");role_datagrid.datagrid("reload");eu.showMsg(a.msg)}else{eu.showAlertMsg(a.msg,"error")}}})}function editRoleResource(){var a=role_datagrid.datagrid("getSelections");var b=role_datagrid.datagrid("getSelected");if(b){if(a.length>1){eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！")}role_resource_dialog=$("<div/>").dialog({title:"角色资源信息",top:20,width:500,height:200,modal:true,maximizable:true,href:ctxAdmin+"/sys/role/resource?id="+b.id,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){role_resource_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){role_resource_dialog.dialog("destroy")}}],onClose:function(){role_resource_dialog.dialog("destroy")},onLoad:function(){initRoleResourceForm()}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function editRoleUser(){var b=role_datagrid.datagrid("getSelections");var c=role_datagrid.datagrid("getSelected");if(c){if(b.length>1){eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！")}var a=ctxAdmin+"/sys/role/user";if(c!=undefined&&c.id){a=a+"?id="+c.id}role_user_dialog=$("<div/>").dialog({title:"角色用户信息",top:20,width:600,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){role_user_dialog.dialog("destroy")}}],onClose:function(){role_user_dialog.dialog("destroy")},onLoad:function(){}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function del(){var a=role_datagrid.datagrid("getSelections");if(a.length>0){$.messager.confirm("确认提示！","您确定要删除选中的所有行？",function(c){if(c){var b=new Array();$.each(a,function(d,e){b[d]=e.id});$.ajax({url:ctxAdmin+"/sys/role/remove",type:"post",data:{ids:b},traditional:true,dataType:"json",success:function(d){if(d.code==1){role_datagrid.datagrid("load");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}}})}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function search(){role_datagrid.datagrid("load",$.serializeObject(role_search_form))};