(function(d,e){d.fn.ueditor=function(m,n){if(typeof m=="string"){var o=d.fn.ueditor.methods[m];if(o){return o(this,n)}else{return this.each(function(){d(this).validatebox(m,n)})}}m=m||{};return this.each(function(){var p=d.data(this,"ueditor");if(p){d.extend(p.options,m)}else{p=d.data(this,"ueditor",{options:d.extend({},d.fn.ueditor.defaults,d.fn.ueditor.parseOptions(this),m)})}l(this)})};function l(p){var o=/^(?:textarea)$/i.test(p.nodeName);if(!o){d.messager.alert("错误","插件限定使用TextArea作为U Editor的装载容器(当前为："+p.nodeName+")！","error");return}var n=d.data(p,"ueditor");n.targetId=targetId=h(p);n.validPanel=d("<input id='"+targetId+"_valid'  type='hidden' value='false'/>");d(p).parent().append(n.validPanel);var m=n.editor=e.getEditor(targetId,n.options);a(p);i(p)}function h(q){var o=d(q),n=o.attr("name");if(d.trim(o.attr("id"))!=""){return o.attr("id")}var m=q.nodeName+"_"+k(9999),p=o.closest("form");if(p&&d.trim(p.attr("id"))!=""&&(d.trim(n)!="")){m=p.attr("id")+"_"+n}o.attr("id",m);return m}function k(m){return Math.floor(Math.random()*m+1)+"_"}function a(p){var o=d.data(p,"ueditor"),m=o.options,n=o.validPanel;d.each(d.fn.ueditor.events,function(q,t){var r="on"+t,s=m[r];o.editor.addListener(t,function(){if(t=="contentChange"){d(p).val(d(p).ueditor("getValue"));n.validatebox("validate")}if(d.isFunction(s)){s.apply(p,arguments)}})})}function i(r){var p=d.data(r,"ueditor");var o=p.options;var q=o.required;var n=p.validPanel;var m=d("#"+p.targetId);var s=m.children(":first");d(n).validatebox(d.extend({},o,{missingMessage:"编辑器内容不能为空！",onBeforeValidate:function(){var t=d(this);if(!m.is(":focus")){var u=d(r).val();t.val((u=="undefined"||d.trim(u))==""?false:true)}},onValidate:function(u){if(!q){m.removeClass("validatebox-invalid");return}var t=d(this);if(t.val()=="true"){m.attr("title","");m.removeClass("validatebox-invalid");s.css({border:"solid 1px #ccc"})}else{m.attr("title",d(this).validatebox("options").missingMessage);m.addClass("validatebox-invalid");s.css({border:"solid 1px #ffa8a8"})}}}))}function g(n){var m=d.data(n,"ueditor");return m.editor.getContent()}function b(n){if(n&&d(n).attr("id")){var m=e.getEditor(d(n).attr("id"));m.ready(function(){return m.getContentTxt()})}}function c(o,n){if(o&&d(o).attr("id")){var m=e.getEditor(d(o).attr("id"));m.ready(function(){m.setContent(n)})}}function f(n){var m=d.data(n,"ueditor");if(m&&m.editor){m.editor.sync()}}function j(n){if(!n){return}var m=d.data(n,"ueditor");if(m){m.editor.destroy();d(n).remove()}}d.fn.ueditor.methods={options:function(m){return d.data(m[0],"ueditor").options},editor:function(m){return d.data(m[0],"ueditor").editor},getValue:function(m){return g(m[0])},getValueTxt:function(m){return b(m[0])},setValue:function(n,m){return n.each(function(){c(this,m)})},sync:function(m){return m.each(function(){f(this)})},destroy:function(m){return m.each(function(){j(this)})}};d.fn.ueditor.events=["destroy","contentChange"];d.fn.ueditor.defaults=d.extend({},d.fn.validatebox.defaults,{toolbars:[["fullscreen","source","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","cleardoc","|"]],zIndex:9999,charset:"utf-8",enableAutoSave:false,oncontentChange:function(){},ondestroy:function(){}});d.fn.ueditor.parseOptions=function(n){var m=d.extend({},d.fn.validatebox.parseOptions(n),d.parser.parseOptions(n));if(m.width){m.initialFrameWidth=m.width}if(m.height){m.initialFrameHeight=m.height}return m};d.extend(d.fn.dialog.defaults,{onBeforeDestroy:function(){d(".easyui-ueditor").ueditor("destroy")}});d.extend(d.fn.form.defaults,{onLoadSuccess:function(n){if(!n){return}var m=d("textarea[class=easyui-ueditor]");if(m){d.each(m,function(){var p=d(this).attr("name");if(p&&n[p]){var o=d(this).prev(".easyui-ueditor");if(o&&d(o).attr("id")){d(o).ueditor("setValue",n[p])}}})}}});d.parser.plugins.push("ueditor")})(jQuery,UE);