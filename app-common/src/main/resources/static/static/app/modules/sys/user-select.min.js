var dataScope=dataScope;var userDatagridData=userDatagridData;var multiple=multiple;var excludeUserIdStrs=excludeUserIdStrs;var $select_user_datagrid;var $select_user_search_form;var $select_organ_tree;var $select_role_tree;var selectUserIds=new Array();var selectUserDatagridData=userDatagridData;$(function(){selectOrganTree();selectRoleTree();$.each($("#selectUser option"),function(a,b){selectUserIds.push(b.value)});userDatagrid()});function userDatagrid(){$select_user_search_form=$("#select_user_search_form").form();var b=new Array();var a={field:"ck",checkbox:true};if(""==multiple||multiple=="true"){b.push(a)}b.push({field:"name",title:"姓名",width:80,sortable:true});$select_user_datagrid=$("#select_user_datagrid").datagrid({url:ctxAdmin+"/sys/user/datagridSelectUser",data:selectUserDatagridData,queryParams:{excludeUserIds:excludeUserIdStrs},fit:true,pagination:true,rownumbers:true,fitColumns:false,striped:true,idField:"id",frozen:true,collapsible:true,mode:"local",autoRowHeight:false,frozenColumns:[b],columns:[[{field:"id",title:"主键",hidden:true,sortable:true,width:10},{field:"sexView",title:"性别",width:50},{field:"defaultOrganName",title:"部门",width:150}]],onCheck:function(d,c){addSelectUser([c])},onCheckAll:function(c){addSelectUser(c)},onUncheck:function(d,c){cancelSelectUser([c])},onUncheckAll:function(c){cancelSelectUser(c)},onDblClickRow:function(d,c){},onLoadSuccess:function(c){selectUserDatagridData=c;$select_user_datagrid=$(this);selectDefault()}})}function selectDefault(){var a=$select_user_datagrid.datagrid("getData").rows;$.each(selectUserIds,function(c,b){$.each(a,function(d,e){if(b==e.id){$select_user_datagrid.datagrid("selectRow",d)}})});sysc()}function addSelectUser(a){$.each(a,function(c,d){var b=false;if($("#selectUser option").length==0){$("#selectUser").append("<option value='"+d.id+"'>"+d.name+"</option>")}else{$("#selectUser option").each(function(){if($(this).val()==d.id){b=true;return}});if(!b){$("#selectUser").append("<option value='"+d.id+"'>"+d.name+"</option>")}}});sysc()}function sysc(){selectUserIds=new Array();$("#selectUser option").each(function(){selectUserIds.push($(this).val())});var a=$("#selectUser option").length;$("#select_layout").layout().layout("panel","east").panel("setTitle","已选择<span style='color: red;'>"+a+"</span>人")}function cancelSelectUser(a){$.each(a,function(b,c){$("#selectUser option[value='"+c.id+"']").remove()});sysc()}function cancelSelectedUser(){$.each($("#selectUser").find("option:selected"),function(b,c){var a=$(c).val();$(c).remove();$.each($select_user_datagrid.datagrid("getSelections"),function(d,e){if(e&&a==e.id&&selectUserDatagridData.rows){$.each(selectUserDatagridData.rows,function(f,g){if(a==g.id){$select_user_datagrid.datagrid("uncheckRow",f)}})}})});sysc()}function selectOrganTree(){var a=null;$select_organ_tree=$("#select_organ_tree").tree({url:ctxAdmin+"/sys/organ/tree?dataScope="+dataScope+"&cascade="+cascade,onClick:function(b){var c=$select_role_tree.tree("getSelected");if(c){$select_role_tree.tree("unSelect",c.target)}search()},onBeforeLoad:function(b,c){$("#select_organ_tree").html("数据加载中...")},onBeforeSelect:function(b){a=b;return true},onLoadSuccess:function(c,d){$(this).tree("collapseAll");var b=$(this).tree("getRoot");if(b){$(this).tree("expand",b.target)}}})}function selectRoleTree(){var a=null;$select_role_tree=$("#select_role_tree").tree({url:ctxAdmin+"/sys/role/tree?dataScope="+dataScope+"&cascade="+cascade,onClick:function(b){var c=$select_organ_tree.tree("getSelected");if(c){$select_organ_tree.tree("unSelect",c.target)}search()},onBeforeSelect:function(c){var b=$(this).tree("getSelected");if(b!=undefined&&c!=undefined){if(b.id==c.id){$(".tree-node-selected",$(this).tree()).removeClass("tree-node-selected");a=null;return false}}a=c;return true},onLoadSuccess:function(b,c){if(a!=null){a=$(this).tree("find",a.id);if(a!=null){$(this).tree("select",a.target)}}$(this).tree("expandAll")}})}function search(){var d=$select_organ_tree.tree("getSelected");var a="";if(d!=null){a=d.id}var c=$select_role_tree.tree("getSelected");var b="";if(c!=null){b=c.id}$select_user_datagrid.datagrid({url:ctxAdmin+"/sys/user/datagridSelectUser",queryParams:{organId:a,roleId:b,excludeUserIds:excludeUserIdStrs,query:$("#query").val()}})};