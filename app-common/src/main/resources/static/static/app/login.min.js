var ctx=ctx;var ctxAdmin=ctxAdmin;var ctxStatic=ctxStatic;var sysInitTime=sysInitTime;var isValidateCodeLogin=isValidateCodeLogin;var rememberMeCookieValue=rememberMeCookieValue;var needEncrypt=needEncrypt;var SALT=SALT;var homePage=homePage;var $loginForm;var $password,$rememberMe;$(function(){$.backstretch([ctxStatic+"/js/images/bg1.jpg?_="+sysInitTime,ctxStatic+"/js/images/bg2.jpg?_="+sysInitTime,ctxStatic+"/js/images/bg3.jpg?_="+sysInitTime],{duration:5000,fade:2000});$("#qr").qrcode({render:"div",size:80,color:"#3a3",text:window.location.href});if(isValidateCodeLogin!=""&&isValidateCodeLogin=="true"){$(".validateCode").show()}$loginForm=$("#loginForm").validate({rules:{validateCode:{remote:ctx+"/servlet/ValidateCodeServlet"}},messages:{loginName:{required:"请填写用户名."},password:{required:"请填写密码."},validateCode:{remote:"验证码不正确.",required:"请填写验证码."}},errorLabelContainer:"#messageBox",errorPlacement:function(b,c){b.appendTo($("#loginError").parent())},submitHandler:function(b){login()}});$password=$("#password");$rememberMe=$("#rememberMe");$rememberMe.prop("checked",rememberMeCookieValue==""?false:true);$password.change(function(){needEncrypt=true});$rememberMe.click(function(){var c=$(this).prop("checked");var b=$password.val();if(needEncrypt){b=md5(b+SALT)}if(c){$.cookie("_password",b,{expires:7});$.cookie("rememberMe",c,{expires:7})}else{$.cookie("_password","",{expires:7});$.cookie("rememberMe","",{expires:7})}});$loginName=$("#loginName").autocomplete(ctxAdmin+"/sys/user/autoComplete",{remoteDataType:"json",minChars:0,maxItemsToShow:10});var a=$loginName.data("autocompleter");a.setExtraParam("rows",a.options.maxItemsToShow)});function login(){$("#messageBox2").addClass("hide");$.cookie("loginName",$("#loginName").val(),{expires:7});var a=$password.val();if(needEncrypt){a=md5(a+SALT)}if($rememberMe.prop("checked")){$.cookie("_password",a,{expires:7})}$.ajax({url:ctxAdmin+"/login/login",type:"post",data:{theme:"",encrypt:true,loginName:$("#loginName").val(),password:a,validateCode:$("#validateCode").val()},traditional:true,async:false,dataType:"json",success:function(b){if(b.code==1){window.location=b.obj.homeUrl}else{$("#validateCode").val("");refreshCheckCode();$("#loginError2").html(b.msg);$("#messageBox2").removeClass("hide");if(b.obj!=undefined&&b.obj==true){$(".validateCode").show()}}}})}function refreshCheckCode(){var a=ctx+"/servlet/ValidateCodeServlet?"+new Date().getTime();$("#validateCodeImage").attr("src",a)}var user_dialog;function chooseUser(){user_dialog=$("<div/>").dialog({title:"用户选择",width:400,height:500,modal:true,maximizable:true,href:ctxAdmin+"/sys/user/organUserTreePage?checkbox=false&cascade=false",buttons:[{text:"确定",iconCls:"easyui-icon-save",handler:function(){setOrganUserResult();user_dialog.dialog("destroy")}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){user_dialog.dialog("close")}}],onClose:function(){user_dialog.dialog("destroy")},onLoad:function(){}})}function setOrganUserResult(a){if(a==undefined){a=$("#organUserTree").tree("getSelected")}if(a){if("u"==a.attributes["nType"]){$("#loginName").val(a.attributes["loginName"]);user_dialog.dialog("close")}}};