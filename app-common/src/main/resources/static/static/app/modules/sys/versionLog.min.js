var $versionLog_datagrid;var $versionLog_search_form;var $versionLog_dialog;var $versionLog_form;$(function(){initDatagrid();$versionLog_search_form=$("#versionLog_search_form").form()});function initDatagrid(){$versionLog_datagrid=$("#versionLog_datagrid").datagrid({url:ctxAdmin+"/sys/versionLog/datagrid",fit:true,pagination:true,rownumbers:true,fitColumns:false,striped:true,pageSize:20,singleSelect:false,checkbox:true,nowrap:true,border:false,idField:"id",frozenColumns:[[{field:"ck",checkbox:true,width:60},{field:"app",title:"APP",width:80},{field:"versionName",title:"版本号",width:120,formatter:function(b,a,c){return"<a href='#' onclick='view(\""+a.id+"\")' >"+b+"</a>"}}]],columns:[[{field:"id",title:"主键",hidden:true,width:120},{field:"versionCode",title:"内部版本号",width:100,align:"right"},{field:"versionLogTypeView",title:"类型",width:120},{field:"remark",title:"更新说明",width:360},{field:"isPubView",title:"是否发布",width:120},{field:"pubTime",title:"发布时间",width:146,sortable:true},{field:"isShelfView",title:"是否下架",width:120},{field:"operate",title:"操作",formatter:function(c,b,d){var a="<a class='easyui-linkbutton' iconCls='easyui-icon-edit' onclick='edit("+d+");' >编辑</a>";a+="&nbsp;<a class='easyui-linkbutton' iconCls='easyui-icon-remove' onclick='del("+d+");' >删除</a>";return a}}]],toolbar:[{text:"新增",iconCls:"easyui-icon-add",handler:function(){showDialog()}},{text:"删除",iconCls:"easyui-icon-remove",handler:function(){del()}},"-",{text:"清空所有",iconCls:"easyui-icon-no",handler:function(){delAll()}}],onLoadSuccess:function(){$(this).datagrid("clearSelections");$(this).datagrid("unselectAll")}}).datagrid("showTooltip")}function view(c){var a=ctxAdmin+"/sys/versionLog/view/"+c;var b=$("<div/>").dialog({title:"查看系统",width:600,height:320,modal:true,maximizable:true,href:a,buttons:[{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){b.dialog("destroy")}}],onClose:function(){b.dialog("destroy")}})}function formInit(){$versionLog_form=$("#versionLog_form").form({url:ctxAdmin+"/sys/versionLog/save",onSubmit:function(b){$.messager.progress({title:"提示信息！",text:"数据处理中，请稍后...."});var a=$(this).form("validate");if(!a){$.messager.progress("close")}return a},success:function(b){$.messager.progress("close");var a=$.parseJSON(b);if(a.code===1){$versionLog_dialog.dialog("destroy");$versionLog_datagrid.datagrid("reload");eu.showMsg(a.msg)}else{if(a.code===2){$.messager.alert("提示信息！",a.msg,"warning",function(){if(a.obj){$('#versionLog_form input[name="'+a.obj+'"]').focus()}})}else{eu.showAlertMsg(a.msg,"error")}}}})}function showDialog(b){var a=ctxAdmin+"/sys/versionLog/input";if(b){a+="?id="+b.id}$versionLog_dialog=$("<div/>").dialog({title:"系统更新详细信息",top:20,width:600,height:360,modal:true,maximizable:true,href:a,buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){$versionLog_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){$versionLog_dialog.dialog("destroy")}}],onClose:function(){$versionLog_dialog.dialog("destroy")},onLoad:function(){formInit();if(b){$versionLog_form.form("load",b)}}})}function edit(d,b){if(d!==undefined){$versionLog_datagrid.datagrid("unselectAll");$versionLog_datagrid.datagrid("selectRow",d);var b=$versionLog_datagrid.datagrid("getSelected");$versionLog_datagrid.datagrid("unselectRow",d);showDialog(b);return}var a=$versionLog_datagrid.datagrid("getSelections");var c=$versionLog_datagrid.datagrid("getSelected");if(c){if(a.length>1){c=a[a.length-1];eu.showMsg("您选择了多个操作对象，默认操作最后一次被选中的记录！")}showDialog(c)}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function del(d){var a=[];var c="您确定要删除";if(d!==undefined){$versionLog_datagrid.datagrid("unselectAll");$versionLog_datagrid.datagrid("selectRow",d);var b=$versionLog_datagrid.datagrid("getSelected");$versionLog_datagrid.datagrid("unselectRow",d);a=[];a.push(b);c+="更新说明["+b.versionName+"]？"}else{c+="选中的所有记录？";a=$versionLog_datagrid.datagrid("getChecked")}if(a.length>0){$.messager.confirm("确认提示！",c,function(f){if(f){var e=[];$.each(a,function(g,h){e[g]=h.id});$.ajax({url:ctxAdmin+"/sys/versionLog/remove",type:"post",data:{ids:e},traditional:true,dataType:"json",success:function(g){if(g.code===1){$versionLog_datagrid.datagrid("clearSelections");$versionLog_datagrid.datagrid("load");eu.showMsg(g.msg)}else{eu.showAlertMsg(g.msg,"error")}}})}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function delAll(){$.messager.confirm("确认提示！","您确认要清空所有数据？",function(a){if(a){$.post(ctxAdmin+"/sys/versionLog/removeAll",function(b){if(b.code===1){$versionLog_datagrid.datagrid("clearSelections");$versionLog_datagrid.datagrid("load");eu.showMsg(b.msg)}else{eu.showAlertMsg(b.msg,"error")}},"json")}})}function search(){$versionLog_datagrid.datagrid("load",$.serializeObject($versionLog_search_form))};