var $layout_portal_portal;var $jplayer;var protal_titles=["&nbsp;我的通知","&nbsp;我的邮件"];$(function(){panels=[{id:"p1",href:ctxAdmin+"/portal/notice",title:protal_titles[0],iconCls:"eu-icon-notice_user_comment",height:300,collapsible:true,tools:[{iconCls:"eu-icon-more",handler:function(){var b=ctxAdmin+"/notice";try{parent.addTabs({id:"notice",title:"我的通知",close:true,url:b,urlType:""})}catch(c){eu.addTab(window.parent.layout_center_tabs,"我的通知",b,true,"eu-icon-notice_user_comment")}}}]}];$("#layout_portal_portal").portal({border:false,fit:true,onStateChange:function(){$.cookie("portal-state",getPortalState(),{expires:7})}});var a=$.cookie("portal-state");if(!a){a="p1"}addPortalPanels(a);$("#layout_portal_portal").portal("resize");initMedia();mymessages(false,true);window.setInterval("mymessages(true,true)",5*60*1000)});function getPanelOptions(b){for(var a=0;a<panels.length;a++){if(panels[a].id===b){return panels[a]}}return undefined}function getPortalState(){var d=[];for(var c=0;c<2;c++){var e=[];var a=$("#layout_portal_portal").portal("getPanels",c);for(var b=0;b<a.length;b++){e.push(a[b].attr("id"))}d.push(e.join(","))}return d.join(":")}function addPortalPanels(e){var c=e.split(":");for(var d=0;d<c.length;d++){var g=c[d].split(",");for(var b=0;b<g.length;b++){var a=getPanelOptions(g[b]);if(a){var f=$("<div/>").attr("id",a.id).appendTo("body");f.panel(a);$("#layout_portal_portal").portal("add",{panel:f,columnIndex:d})}}}}function initMedia(){$jplayer=$("#jplayer").jPlayer({swfPath:ctxStatic+"/js/jquery/jplayer/Jplayer.swf",ready:function(){$(this).jPlayer("setMedia",{mp3:ctxStatic+"/media/tip_new_msg.mp3"})},supplied:"mp3"})}function tipMsg(){var a=$.cookie("portal-tipMessage")!=="false";if(a){$jplayer.jPlayer("play")}var b="<span>您有新的消息，请注意查收！</span>";b+="<div style='margin-top: 10px;'><label><input id='tip_checkbox' type='checkbox' onclick='setTipMessage(this.checked);' ";if(a){b+=" checked "}b+="/> 提示声音</label></div>";$.messager.show({title:'<span class="tree-icon tree-file easyui-icon-tip easyui-tooltip"></span><span style="color: red;"> 提示信息！</span>',msg:b,height:110,timeout:5000,showType:"slide"})}function setTipMessage(a){$.cookie("portal-tipMessage",a,{expires:7})}function mymessages(a,b){$.ajax({url:ctxAdmin+"/portal/mymessages",type:"POST",dataType:"json",success:function(d){if(d.code===1){if(a){$("#p1").panel("refresh")}var c=false;var f=d.obj;var e=undefined;if(f.noticeReceiveInfos>0){c=true;e="&nbsp;<span  style='color: #FE6600;font-size: 16px;'>"+f.noticeReceiveInfos+"</span>&nbsp条"}else{e="&nbsp;<span>"+f.noticeReceiveInfos+"</span>&nbsp;条"}$("#p1").panel("setTitle",protal_titles[0]+e);if(f.passwordTip!==undefined&&f.passwordTip["tip"]===true){var g="";if(f.passwordTip["code"]===1){g="您从未修改过用户密码，请<a onclick='updateUserPassword(\""+f.passwordTip["url"]+"\");'>设置用户密码</a>！"}else{if(f.passwordTip["code"]===2){g="距离上次修改密码已经很长时间了，请<a onclick='updateUserPassword(\""+f.passwordTip["url"]+"\");'>修改用户密码</a>！"}}if(g!==""){$.messager.show({title:'<span class="tree-icon tree-file easyui-icon-tip easyui-tooltip"></span><span style="color: red;"> 提示信息！</span>',msg:g,height:110,timeout:30*1000,showType:"slide"})}}}else{}}})}function updateUserPassword(a){var b=a?a:(ctx+"/a/index/password");parent.addTabs({id:"index_password",title:"密码修改",close:true,url:b,urlType:""})};