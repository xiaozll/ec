var modelIsTop=modelIsTop;var modelTipMessage=modelTipMessage;var modelType=modelType;var dictionaryTypeCode=dictionaryTypeCode;var modelFileIds=modelFileIds;var noticeReceiveUserIds=noticeReceiveUserIds;var noticeReceiveOrganIds=noticeReceiveOrganIds;var jsessionid=jsessionid;var fileSizeLimit=fileSizeLimit;var $form_noticeUser_MultiSelect=undefined;var $form_noticeOrgan_combotree=undefined;$(function(){loadReceiveScope();var a=$("input[name=isTop]:eq("+modelIsTop+")");a.prop("checked","checked");toggoleIsTop(a.val());$("input[name=isTop]").bind("click",function(){toggoleIsTop($(this).val())});if(modelTipMessage){var c=modelTipMessage.split(",");var b=document.getElementsByName("tipMessage");for(i=0;i<b.length;i++){for(j=0;j<c.length;j++){if(b[i].value==c[j]){b[i].checked=true;break}}}}uploadify();editor();if($("#head_image").val()){addImageFile($("#head_image").val())}uploadifyHeadImage()});function editor(){$("#editor").kendoEditor({encoded:false,resizable:{content:true,toolbar:true}})}function loadNoticeType(){$("#notice_type").combobox({url:ctxAdmin+"/sys/dictionary/combobox?dictionaryTypeCode="+dictionaryTypeCode+"&selectType=select",multiple:false,editable:false,width:120,height:28,value:modelType,validType:["comboboxRequired['#notice_type']"]})}function loadReceiveScope(){$("#receiveScope").combobox({url:ctxAdmin+"/notice/receiveScopeCombobox",multiple:false,editable:false,required:true,missingMessage:"请选择接收范围.",onChange:function(b,a){toggoleReceiveScope(b)},onLoadSuccess:function(){var a=$(this).combobox("getValue");toggoleReceiveScope(a)}})}function toggoleReceiveScope(a){if("0"==a){$("#noticeUserIds_div").show();$("#noticeOrganIds_div").show();if($form_noticeUser_MultiSelect==undefined){loadNoticeUser()}if($form_noticeOrgan_combotree==undefined){loadNoticeOrgan()}}else{$("#noticeUserIds_div").hide();if($form_noticeUser_MultiSelect!=undefined){$form_noticeUser_MultiSelect.value(" ")}$("#noticeOrganIds_div").hide();if($form_noticeOrgan_combotree!=undefined){$form_noticeOrgan_combotree.combotree("setValue","")}}}function toggoleIsTop(a){if("0"==a){$("#endTopDay_span").hide()}else{$("#endTopDay_span").show();if(!$("#endTopDay").numberspinner().numberspinner("getValue")){$("#endTopDay").numberspinner("setValue",7)}}}function loadNoticeOrgan(){$form_noticeOrgan_combotree=$("#_noticeOrganIds").combotree({url:ctxAdmin+"/sys/organ/tree?dataScope=2&cascade=true",multiple:true,editable:false,value:noticeReceiveOrganIds})}var fileIdArray=modelFileIds;var fileIds=fileIdArray.join(",");$("#fileIds").val(fileIds);var dataMap=new HashMap();function uploadify(){$("#uploadify").Huploadify({auto:true,showUploadedPercent:true,showUploadedSize:true,uploader:ctxAdmin+"/notice/upload",formData:{},fileObjName:"uploadFile",multi:true,fileSizeLimit:fileSizeLimit,removeTimeout:24*60*60*1000,fileTypeExts:"*.*",onUploadStart:function(file){},onInit:function(obj){},onUploadComplete:function(file,data){data=eval("("+data+")");if(data.code!=undefined&&data.code=="1"){fileIdArray.push(data.obj["id"]);var _fileIds=fileIdArray.join(",");$("#fileIds").val(_fileIds);dataMap.put(file.index,data.obj)}else{$("#"+file.id).find(".data").html(" - <font color=#D94600>"+data.msg+"</font>")}},onCancel:function(file){var sf=dataMap.get(file.index);delUpload(sf.id);dataMap.remove(file.index)}})}function addImageFile(d,a){$("#head_image").val(d);if(a){$("#head_image_pre").attr("src",a)}$("#head_image_pre").show();$("#head_image_pre").next().show();var c=$("#head_image_pre").position().left;var b=$("#head_image_pre").position().top;$("#head_image_cencel").css({position:"absolute",left:c+75,top:b+10,display:"block"})}function delImageFile(){$("#head_image_pre").attr("src","");$("#head_image_pre").hide();$("#head_image_pre").next().hide();$("#head_image").val("")}function uploadifyHeadImage(){$("#head_image_uploadify").Huploadify({auto:true,showUploadedPercent:true,showUploadedSize:true,uploader:ctxAdmin+"/notice/upload",formData:{},fileObjName:"uploadFile",buttonText:"浏 览",multi:false,fileSizeLimit:fileSizeLimit,removeTimeout:24*60*60*1000,fileTypeExts:"*.gif; *.jpg; *.png; *.bmp",onUploadSuccess:function(file,data,response){data=eval("("+data+")");if(1===data.code){addImageFile(data.obj["id"],data.obj["url"]);dataMap.put(file.index,data.obj)}else{$("#"+file.id).find(".data").html(" - <font color=#D94600>"+data.msg+"</font>")}},onCancel:function(file){var sf=dataMap.get(file.index);delImageFile(sf.id);dataMap.remove(file.index)}})}function loadOrOpen(a){$("#annexFrame").attr("src",ctxAdmin+"/disk/fileDownload/"+a)}function delUpload(a){fileIdArray.splice($.inArray(a,fileIdArray),1);var b=fileIdArray.join(",");$("#fileIds").val(b);delUploadFile(a)}function delUploadFile(a){$.ajax({url:ctxAdmin+"/disk/delFolderFile",type:"post",data:{fileIds:a},dataType:"json",traditional:true,success:function(b){if(1===b.code){$("#"+a).remove()}}})}function loadNoticeUser(){var a={data:[],group:{field:"defaultOrganName"}};$form_noticeUser_MultiSelect=$("#noticeUserIds").kendoMultiSelect({dataTextField:"name",dataValueField:"id",dataSource:a,value:noticeReceiveUserIds,dataBound:function(b){}}).data("kendoMultiSelect");$.ajax({type:"post",dataType:"json",contentType:"application/json",url:ctxAdmin+"/sys/user/userList?dataScope=2",success:function(b){var c={data:b,group:{field:"defaultOrganName"}};$form_noticeUser_MultiSelect.setDataSource(c);$form_noticeUser_MultiSelect.value(noticeReceiveUserIds)}})}function _selectUser(){var d="";var b=$form_noticeUser_MultiSelect.dataItems();if(b&&b.length>0){var a=b.length;$.each(b,function(f,e){if(f==a-1){d+=e.id}else{d+=e.id+","}})}var c=$("<div/>").dialog({title:"选择用户",top:10,href:ctxAdmin+"/sys/user/select?dataScope=2&cascade=true&userIds="+d,width:"700",height:"450",maximizable:true,iconCls:"easyui-icon-edit",modal:true,buttons:[{text:"确定",iconCls:"easyui-icon-save",handler:function(){_setSelectUser();c.dialog("destroy")}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){c.dialog("destroy")}}],onClose:function(){c.dialog("destroy")}})}function _setSelectUser(){var a=new Array();$("#selectUser option").each(function(){var b=$(this).val();a.push($.trim(b))});$form_noticeUser_MultiSelect.value(a)};