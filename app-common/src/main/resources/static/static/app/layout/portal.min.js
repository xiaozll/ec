var $layout_portal_portal;var $jplayer;var protal_titles=["&nbsp;我的通知","&nbsp;我的邮件"];$(function(){panels=[{id:"p1",href:ctxAdmin+"/portal/notice",title:protal_titles[0],iconCls:"eu-icon-notice_user_comment",height:300,collapsible:true,tools:[{iconCls:"eu-icon-more",handler:function(){var b=ctxAdmin+"/notice";try{parent.addTabs({id:"notice",title:"我的通知",close:true,url:b,urlType:""})}catch(c){eu.addTab(window.parent.layout_center_tabs,"我的通知",b,true,"eu-icon-notice_user_comment")}}}]}];$("#layout_portal_portal").portal({border:false,fit:true,onStateChange:function(){$.cookie("portal-state",getPortalState(),{expires:7})}});var a=$.cookie("portal-state");if(!a){a="p1"}addPortalPanels(a);$("#layout_portal_portal").portal("resize");initMedia();mymessages(false,true);window.setInterval("mymessages(true,true)",5*60*1000)});function getPanelOptions(b){for(var a=0;a<panels.length;a++){if(panels[a].id===b){return panels[a]}}return undefined}function getPortalState(){var d=[];for(var c=0;c<2;c++){var e=[];var a=$("#layout_portal_portal").portal("getPanels",c);for(var b=0;b<a.length;b++){e.push(a[b].attr("id"))}d.push(e.join(","))}return d.join(":")}function addPortalPanels(e){var c=e.split(":");for(var d=0;d<c.length;d++){var g=c[d].split(",");for(var b=0;b<g.length;b++){var a=getPanelOptions(g[b]);if(a){var f=$("<div/>").attr("id",a.id).appendTo("body");f.panel(a);$("#layout_portal_portal").portal("add",{panel:f,columnIndex:d})}}}}function initMedia(){$jplayer=$("#jplayer").jPlayer({swfPath:ctxStatic+"/js/jquery/jplayer/Jplayer.swf",ready:function(){$(this).jPlayer("setMedia",{mp3:ctxStatic+"/media/tip_new_msg.mp3"})},supplied:"mp3"})}function tipMsg(){var a=$.cookie("portal-tipMessage")!=="false";if(a){$jplayer.jPlayer("play")}var b="<span>您有新的消息，请注意查收！</span>";b+="<div style='margin-top: 10px;'><label><input id='tip_checkbox' type='checkbox' onclick='setTipMessage(this.checked);' ";if(a){b+=" checked "}b+="/> 提示声音</label></div>";$.messager.show({title:'<span class="tree-icon tree-file easyui-icon-tip easyui-tooltip"></span><span style="color: red;"> 提示信息！</span>',msg:b,height:110,timeout:5000,showType:"slide"})}function setTipMessage(a){$.cookie("portal-tipMessage",a,{expires:7})}function mymessages(a,b){$.ajax({url:ctxAdmin+"/portal/mymessages",type:"get",dataType:"json",success:function(d){if(d.code===1){if(a){$("#p1").panel("refresh")}var c=false;var f=d.obj;var e=undefined;if(f.noticeReceiveInfos>0){c=true;e="&nbsp;<span  style='color: #FE6600;font-size: 16px;'>"+f.noticeReceiveInfos+"</span>&nbsp条"}else{e="&nbsp;<span>"+f.noticeReceiveInfos+"</span>&nbsp;条"}$("#p1").panel("setTitle",protal_titles[0]+e);if(f.tipPasswordType!==undefined&&f.tipPasswordType!==null){var g="";if(f.tipPasswordType===0){g="您从未修改过用户密码，请<a onclick='try { parent.editLoginUserPassword();} catch(e) {editLoginUserPassword(); }'>修改用户密码</a>！"}else{if(f.tipPasswordType===1){g="距离上次修改密码已经很长时间了，请<a onclick='try { parent.editLoginUserPassword();} catch(e) {editLoginUserPassword(); }'>修改用户密码</a>！"}}if(g!==""){$.messager.show({title:'<span class="tree-icon tree-file easyui-icon-tip easyui-tooltip"></span><span style="color: red;"> 提示信息！</span>',msg:g,height:110,timeout:30*1000,showType:"slide"})}}}else{}}})}var login_password_dialog;var login_password_form;function initLoginPasswordForm(){login_password_form=$("#login_password_form").form({url:ctxAdmin+"/sys/user/updateUserPassword",onSubmit:function(param){param.upateOperate="1";return $(this).form("validate")},success:function(data){var json=eval("("+data+")");if(json.code===1){login_about_dialog.dialog("close");eu.showMsg(json.msg)}else{if(json.code===2){$.messager.alert("提示信息！",json.msg,"warning",function(){var userId=$("#login_password_form_id").val();$(this).form("clear");$("#login_password_form_id").val(userId);if(json.obj){$('#login_password_form input[name="'+json.obj+'"]').focus()}})}else{eu.showAlertMsg(json.msg,"error")}}}})}function editLoginUserPassword(){login_password_dialog=$("<div/>").dialog({title:"&nbsp;修改用户密码",top:100,width:460,height:240,modal:true,iconCls:"easyui-icon-edit",href:ctxAdmin+"/common/layout/north-password",buttons:[{text:"保存",iconCls:"easyui-icon-save",handler:function(){login_password_form.submit()}},{text:"关闭",iconCls:"easyui-icon-cancel",handler:function(){login_password_dialog.dialog("destroy")}}],onClose:function(){login_password_dialog.dialog("destroy")},onLoad:function(){initLoginPasswordForm()}})};